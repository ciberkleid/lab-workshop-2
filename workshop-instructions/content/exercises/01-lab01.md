# Intro to the Color Application

## App overview
For the following exercises, you will be using an application that displays colors to the end user. 
Each time the end user refreshes the page in a browser, a different color is displayed.

The application comprises the following Spring Boot apps:
1. Auth Gateway App - Intercepts all requests and ensures the user is authenticated; if the user is not authenticated, it redirects the request to a login page.
2. Routing Gateway App - Intercepts all authenticated requests and forwards them to the proper Spring Boot app; requests generated by end users are forwarded to the frontend app, while requests generated by the frontend app are forwarded to a backend app.
3. Frontend App - Produces the HTML and JavaScript that will be served to the end user.
4. Color App - Returns a particular color; three instances of this app will be started: one will return blue, another green, and another yellow.

## Download the source code

Start by cloning the application:
```execute-1
git clone https://github.com/ryanjbaxter/gateway-s1p-2018.git color-app
cd color-app
```

List the directories in the repository and compare them to the list above. 
You can ignore the `route-service-broker` as we will not be using that app in this workshop. 
Otherwise, notice the correlation of apps in the list above to directories (the cloned repo uses `blueorgreen` as a prefix in the app names for the Routing Gateway, the Frontend, and the Color Apps).
```execute-1
ls
```

The application uses Eureka for service discovery. 
This enables you to expose only the Auth Gateway to the end user, and keep the other apps securely hidden behind it on an internal network. 
The Auth Gateway uses Eureka to look up the endpoint of the Routing Gateway, and the Routing Gateway looks up the endpoints of the frontend app and of the three instances of the color app (blue, green, and yellow) to route requests appropriately.

The cloned repo does not include Eureka. 
Use `start.spring.io` to create a Eureka application:
```execute-1
curl https://start.spring.io/starter.tgz \
            -d dependencies=cloud-eureka-server \
            -d name=eureka-server \
            -d artifactId=eureka-server \
            -d baseDir=eureka-server | tar -xzvf -
```

Add the annotation `@EnableEurekaServer` to the main application class.
```editor:insert-lines-before-line
file: ~/color-app/eureka-server/src/main/java/com/example/eurekaserver/EurekaServerApplication.java
line: 6
text: |
    import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

    @EnableEurekaServer

```

Set the application port to 8761, the default port for Eureka servers. 
Also, this application only needs to act as a server - it does not need to register itself as a client as well. 
Hence, you can disable the built-in Eureka Client.
```editor:insert-lines-before-line
file: ~/color-app/eureka-server/src/main/resources/application.properties
line: 1
text: |
    server.port=8761
    eureka.client.register-with-eureka=false
    eureka.client.fetch-registry=false
```
